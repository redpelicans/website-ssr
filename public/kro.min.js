!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):this[e]=t()}("$kro",function(){function log(e){$kro.debug&&console.log("["+(new Date-t0)+"ms] "+e)}function makeEvent(e){var t=$kro.events[e];return t||(log('register event: "'+e+'"'),t={type:EVENT_TYPE,loaded:0},$kro.events[e]=t),t}function makeTargetId(e,t,r){if(e)return e;if(t&&r)return r.join()+t.join();if(t)return t.join();if(r)return r.join();throw new Error("Malformed $kro() params")}function makeTarget(e){var t=$kro.targets[e];return t||(log('build target: "'+e+'"'),t={id:e,deps:[]},$kro.targets[t.id]=t),t}function makeScript(e){var t=$kro.scripts[e];return t||(log('request script: "'+e+'"'),t={type:SCRIPT_TYPE,loaded:0,processed:0,href:e},$kro.scripts[e]=t,createXHR(t)),t}function setDebug(e){"debug"in e&&($kro.debug=!!e.debug)}function processDep(dep){switch(dep.type){case SCRIPT_TYPE:dep.processed||(log('eval script: "'+dep.href+'"'),eval(dep.code),dep.code=void 0,dep.processed=1);break;case EVENT_TYPE:}}function runTarget(e){var t=e.deps.length,r=0;e.deps.forEach(function(e){(e.loaded||e.processed)&&r++}),r&&r===t&&(e.deps.forEach(processDep),delete $kro.targets[e.id],log('trigger target: "'+e.id+'"'),e.done&&e.done(),e.emit&&setTimeout(function(){$kro.emit(e.emit)},0))}function runTargets(){Object.keys($kro.targets).forEach(function(e){runTarget($kro.targets[e])})}function getXHRObject(){var e=!1;try{e=new XMLHttpRequest}catch(t){for(var r=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<r.length;++n){try{e=new ActiveXObject(r[n])}catch(t){continue}break}}finally{return e}}function createXHR(e){var t=getXHRObject();if(!t)throw new Error("Cannot use XMLHttpRequest()");t.onreadystatechange=function(){4===t.readyState&&200===t.status&&(e.code=t.responseText,e.loaded=1,log('get script: "'+e.href+'"'),runTargets())},t.open("GET",e.href,!0),t.send("")}const EVENT_TYPE="event",SCRIPT_TYPE="script",$kro={targets:{},scripts:{},events:{}},t0=new Date;return $kro.sync=function(e){if(!e)throw new Error("Malformed $kro() params");setDebug(e);var t=e.scripts&&(e.scripts.push?e.scripts:[e.scripts]),r=e.events&&(e.events.push?e.events:[e.events]),n=makeTargetId(e.target,t,r),o=makeTarget(n);return e.emit&&(o.emit=e.emit,makeEvent(o.emit)),e.ready&&(o.done=e.ready),t&&t.forEach(function(e){var t=makeScript(e);o.deps.push(t)}),r&&r.forEach(function(e){o.deps.push(makeEvent(e))}),runTarget(o),$kro},$kro.emit=function(e){log('emit: "'+e+'"');var t=makeEvent(e);return t.loaded++,runTargets(),$kro},$kro.reset=function(){return $kro.debug=!1,$kro.events={},$kro.scripts={},$kro.targets={},$kro},$kro.ready=function(e,t){var r=makeTarget(e);return r.done=t,runTarget(r),$kro},$kro});